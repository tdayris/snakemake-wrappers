.. _`bio/bcftools/merge`:

BCFTOOLS MERGE
==============

Merge vcf/bcf files with bcftools.

**URL**: https://samtools.github.io/bcftools/bcftools.html#index

Example
-------

This wrapper can be used in the following way:

.. code-block:: python

    rule bcftools_merge:
        input:
            calls=["a.bcf", "b.bcf"]
        output:
            "all.bcf"
        params:
            ""  # optional parameters for bcftools concat (except -o)
        wrapper:
            "0.77.0-1061-gc0678288b/bio/bcftools/merge"

Note that input, output and log file paths can be chosen freely.

When running with

.. code-block:: bash

    snakemake --use-conda

the software dependencies will be automatically deployed into an isolated environment before execution.

Software dependencies
---------------------

* ``bcftools=1.12``



Params
------

* ``Optional parameters, must be the first and only value in snakemake's params.``: 




Notes
-----

BCFTools will take longer to merge non-gzipped VCF files.



Authors
-------

* Patrik Smeds


Code
----

.. code-block:: python

    __author__ = "Patrik Smeds"
    __copyright__ = "Copyright 2018, Patrik Smeds"
    __email__ = "patrik.smeds@gmail.com"
    __license__ = "MIT"


    from snakemake.shell import shell
    log = snakemake.log_fmt_shell(stdout=True, stderr=True)

    extra = snakemake.params[0]
    output_file = snakemake.output[0]
    if output_file.endswith(".bcf"):
        extra += " --output-type b "
    elif output_file.endswith(".vcf.gz"):
        extra += " --output-type z "
    elif output_file.endswith(".vcf"):
        extra += " --output-type v "
    else:
        raise ValueError(
            "Output file extension should be one of: vcf, bcf, vcf.gz"
        )

    region_file = ""
    if "regions" in snakemake.input.keys():
        region_file = " --regions-file {}".format(snakemake.input["regions"])


    shell(
        " bcftools merge "
        " {extra} "
        " {region_file} "
        " --threads {snakemake.threads} "
        " --output {output_file} "
        " {snakemake.input.calls} "
        " {log} "
    )
