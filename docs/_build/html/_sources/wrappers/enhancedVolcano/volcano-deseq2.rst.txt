.. _`Volcano-DESeq2`:

VOLCANO-DESEQ2
==============

Plot a Volcano plot from DESeq2 raw results


Example
-------

This wrapper can be used in the following way:

.. code-block:: python

    rule test_volcano:
        input:
            deseq2_tsv = "diff.tsv"
        output:
            png = "Volcano.png"
        log:
            "logs/test_volcano.log"
        wrapper:
            "0.67.0-365-g942457b2/bio/enhancedVolcano/volcano-deseq2"


Note that input, output and log file paths can be chosen freely.
When running with

.. code-block:: bash

    snakemake --use-conda

the software dependencies will be automatically deployed into an isolated environment before execution.

Software dependencies
---------------------

* ``conda-forge:r-readr=1.3.1``
* ``bioconda:bioconductor-enhancedvolcano=1.4.0``

Input/Output
------------
**Input:**

* A TSV-formatted DESeq2 table

**Output:**

* A PNG-formatted volcano plot



Notes
-----

Parameters:
* alpha_threshold: Significance threshold
* fc_threshold: Fold change significance threshold



Authors
-------

* Thibault Dayris


Code
----

.. code-block:: R

    #!/usr/bin/R

    # This script builds a volcano plot from a deseq2 tsv file

    # Loading libraries
    base::library(package = "readr", quietly = TRUE);  # Read large dataset
    base::library(package = "EnhancedVolcano", quietly = TRUE);  # Perform volcano plot

    dataset <- utils::read.table(
      file = snakemake@input[["deseq2_tsv"]],
      header = TRUE,
      sep = "\t",
      stringsAsFactors = FALSE
    );


    padj_threshold <- 0.05
    if ("padj_threshold" %in% snakemake@params) {
      padj_threshold <- snakemake@params[["padj_threshold"]];
    }

    fc_threshold <- 0.5
    if ("fc_threshold" %in% snakemake@params) {
      fc_threshold <- snakemake@params[["fc_threshold"]];
    }


    grDevices::png(
      filename = snakemake@output[["png"]],
      width = 1024,
      height = 768,
      units = "px"
    );

    EnhancedVolcano::EnhancedVolcano(
      dataset,
      lab = rownames(dataset),
      x = "log2FoldChange",
      y = "padj",
      pCutoff = padj_threshold,
      FCcutoff = fc_threshold,
      title = "Volcano plot",
      subtitle = snakemake@params[["condition_name"]],
      pLabellingCutoff = 10^-1000000
    );


    dev.off();
